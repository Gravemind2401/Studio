<Application x:Class="Sandbox.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:s="clr-namespace:Studio.Controls;assembly=Studio"
             xmlns:m="clr-namespace:Sandbox.Models"
             xmlns:u="clr-namespace:Sandbox.Utilities"
             xmlns:su="clr-namespace:Studio.Utilities;assembly=Studio"
             xmlns:local="clr-namespace:Sandbox"
             StartupUri="MainWindow.xaml">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Studio;component/Themes/Blue.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <u:TabTreeTemplateSelector x:Key="tabTreeTemplateSelector" />

            <DataTemplate x:Key="SplitPaneTemplate" DataType="m:SplitModel">
                <s:SplitContainer Orientation="{Binding Orientation}"
                    Panel1Content="{Binding Item1}"
                    Panel1Size="{Binding Item1Size}"
                    Panel2Content="{Binding Item2}"
                    Panel2Size="{Binding Item2Size}"
                    Panel1MinSize="65" Panel2MinSize="65"
                    ContentTemplateSelector="{StaticResource tabTreeTemplateSelector}" />
            </DataTemplate>
            
            <DataTemplate x:Key="DocumentGroupTemplate" DataType="m:TabGroupModel">
                <s:DocumentWell ItemsSource="{Binding Children}"
                                s:DockManager.IsActive="{Binding IsActive}"
                                SelectedItem="{Binding SelectedItem}"
                                OverflowItemSelectedCommand="{Binding SelectItemCommand}">
                    <TabControl.ContentTemplate>
                        <DataTemplate>
                            <ContentPresenter Content="{Binding Content}" />
                        </DataTemplate>
                    </TabControl.ContentTemplate>
                    <TabControl.ItemContainerStyle>
                        <Style TargetType="s:TabWellItem" BasedOn="{StaticResource {x:Static s:DocumentWell.DocumentTabStyleKey}}">
                            <Setter Property="CloseCommand" Value="{Binding Parent.CloseTabCommand}" />
                            <Setter Property="TogglePinStatusCommand" Value="{Binding Parent.TogglePinStatusCommand}" />
                            <Setter Property="Header" Value="{Binding Header}" />
                            <Setter Property="s:DockManager.IsPinned" Value="{Binding IsPinned}" />
                        </Style>
                    </TabControl.ItemContainerStyle>
                </s:DocumentWell>
            </DataTemplate>

            <DataTemplate x:Key="ToolGroupTemplate" DataType="m:TabGroupModel">
                <s:ToolWell ItemsSource="{Binding Children}"
                            s:DockManager.IsActive="{Binding IsActive}"
                            SelectedItem="{Binding SelectedItem}"
                            Caption="{Binding SelectedItem.ToolTip}"
                            CloseCommand="{Binding CloseTabCommand}"
                            TogglePinStatusCommand="{Binding TogglePinStatusCommand}">
                    <su:ProxyBinding.ProxyBindings>
                        <su:ProxyBindingCollection>
                            <su:ProxyBinding Source="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                             Target="{Binding Width, Mode=OneWayToSource}" />
                            <su:ProxyBinding Source="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=TabControl}}"
                                             Target="{Binding Height, Mode=OneWayToSource}" />
                        </su:ProxyBindingCollection>
                    </su:ProxyBinding.ProxyBindings>
                    <TabControl.ContentTemplate>
                        <DataTemplate>
                            <ContentPresenter Content="{Binding Content}" />
                        </DataTemplate>
                    </TabControl.ContentTemplate>
                    <TabControl.ItemContainerStyle>
                        <Style TargetType="s:TabWellItem" BasedOn="{StaticResource {x:Static s:ToolWell.ToolTabStyleKey}}">
                            <Setter Property="CloseCommand" Value="{Binding Parent.CloseTabCommand}" />
                            <Setter Property="TogglePinStatusCommand" Value="{Binding Parent.TogglePinStatusCommand}" />
                            <Setter Property="Header" Value="{Binding Header}" />
                        </Style>
                    </TabControl.ItemContainerStyle>
                </s:ToolWell>
            </DataTemplate>
            
            <DataTemplate x:Key="DockedToolTemplate" DataType="m:TabModel">
                <DataTemplate.Resources>
                    <u:GridLengthConverter x:Key="gridLengthConverter" />
                </DataTemplate.Resources>
                <s:SplitContainer x:Name="split"
                        VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                        VerticalContentAlignment="Stretch" HorizontalContentAlignment="Stretch"
                        Panel1MinSize="65" Panel2MinSize="65">
                    <s:SplitContainer.SplitterStyle>
                        <Style TargetType="GridSplitter">
                            <Setter Property="ResizeBehavior" Value="PreviousAndNext" />
                            <Setter Property="ShowsPreview" Value="True" />
                            <Setter Property="Background" Value="{DynamicResource Environment.EnvironmentBackground}" />
                            <Setter Property="MinWidth" Value="3" />
                            <Setter Property="MinHeight" Value="3" />
                            <Setter Property="HorizontalAlignment" Value="Stretch" />
                            <Setter Property="VerticalAlignment" Value="Stretch" />
                        </Style>
                    </s:SplitContainer.SplitterStyle>
                    <s:SplitContainer.ContentTemplate>
                        <DataTemplate>
                            <s:ToolWell s:DockManager.IsActive="{Binding IsActive}"
                                        s:DockManager.IsPinned="True"
                                        CloseCommand="{Binding Parent.CloseTabCommand}"
                                        TogglePinStatusCommand="{Binding Parent.TogglePinStatusCommand}"
                                        Caption="{Binding ToolTip}">
                                <s:TabWellItem Content="{Binding Content}" />
                            </s:ToolWell>
                        </DataTemplate>
                    </s:SplitContainer.ContentTemplate>
                </s:SplitContainer>
                <DataTemplate.Triggers>
                    <DataTrigger Binding="{Binding SelectedItemDock, RelativeSource={RelativeSource AncestorType=s:DockContainer}}" Value="Left">
                        <Setter TargetName="split" Property="Margin" Value="0,6" />
                        <Setter TargetName="split" Property="Orientation" Value="Horizontal" />
                        <Setter TargetName="split" Property="Panel1Content" Value="{Binding}" />
                        <Setter TargetName="split" Property="Panel1Size" Value="{Binding Width, Converter={StaticResource gridLengthConverter}}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedItemDock, RelativeSource={RelativeSource AncestorType=s:DockContainer}}" Value="Top">
                        <Setter TargetName="split" Property="Margin" Value="6,0" />
                        <Setter TargetName="split" Property="Orientation" Value="Vertical" />
                        <Setter TargetName="split" Property="Panel1Content" Value="{Binding}" />
                        <Setter TargetName="split" Property="Panel1Size" Value="{Binding Height, Converter={StaticResource gridLengthConverter}}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedItemDock, RelativeSource={RelativeSource AncestorType=s:DockContainer}}" Value="Right">
                        <Setter TargetName="split" Property="Margin" Value="0,6" />
                        <Setter TargetName="split" Property="Orientation" Value="Horizontal" />
                        <Setter TargetName="split" Property="Panel2Content" Value="{Binding}" />
                        <Setter TargetName="split" Property="Panel2Size" Value="{Binding Width, Converter={StaticResource gridLengthConverter}}" />
                    </DataTrigger>
                    <DataTrigger Binding="{Binding SelectedItemDock, RelativeSource={RelativeSource AncestorType=s:DockContainer}}" Value="Bottom">
                        <Setter TargetName="split" Property="Margin" Value="6,0" />
                        <Setter TargetName="split" Property="Orientation" Value="Vertical" />
                        <Setter TargetName="split" Property="Panel2Content" Value="{Binding}" />
                        <Setter TargetName="split" Property="Panel2Size" Value="{Binding Height, Converter={StaticResource gridLengthConverter}}" />
                    </DataTrigger>
                </DataTemplate.Triggers>
            </DataTemplate>
        </ResourceDictionary>
    </Application.Resources>
</Application>
